<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="utf-8">

        <title>Detecting interlaced video with ffmpeg</title>

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <meta name="description" content="This small article describes how to use ffmpeg's commandline tools to detect pretty accurately whether or not a video files is interlaced">
        <meta name="keywords" content="ffmpeg">
        <meta name="author" content="Nicolas Hillegeer">
        <meta name="generator" content="nanoc 4.12.19">
        <meta name="robots" content="index,follow">

        <meta property="og:title" content="Detecting interlaced video with ffmpeg">
        <meta property="og:site_name" content="Nicolas Hillegeer - Portfolio and personal blog">
        <meta property="og:type" content="blog">
        <meta property="og:url" content="http://www.aktau.be/2013/09/22/detecting-interlaced-video-with-ffmpeg/">

        <!-- Google Fonts embed code -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400&display=swap" rel="stylesheet">

        
        <link rel="stylesheet" type="text/css" href="/stylesheets/all.css">
        

        <link rel="alternate" type="application/atom+xml" title="Posts" href="/atom.xml" />

        <!--[if lt IE 9]><script src="/js/html5shiv.js"></script><![endif]-->
    </head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BPQY780BNR"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      // Old universal analytics ID: ga('create', 'UA-37726728-1', 'aktau.be');
      gtag('config', 'G-BPQY780BNR');
    </script>
    <body>
        <nav>
            <h2>Nicolas Hillegeer</h2>
            <ul>
                <li><a href="/">Blog</a></li>
                <li><a href="/archive/">Archive</a></li>
                <li><a href="/cv-alt/cv.pdf" title="Résumé">Curriculum Vitae</a></li>
                <li><a href="/contact/" title="Personal information">About &amp; Contact</a></li>
            </ul>
            <h2>Online presence</h2>
            <ul>
                <li><a href="https://github.com/Aktau/">Github</a></li>
                <li><a href="https://twitter.com/alazyleopard">Twitter</a></li>
                <li><a href="http://stackoverflow.com/users/558819/aktau">Stack Overflow</a></li>
                <li><a href="https://soundcloud.com/aktau">Soundcloud</a></li>
            </ul>
            <!--
            <h2>Tags</h2>
            <ul>
                
                <li><a href="/tag/introduction">introduction (1)</a></li>
                
                <li><a href="/tag/nanoc">nanoc (1)</a></li>
                
                <li><a href="/tag/pygments">pygments (1)</a></li>
                
                <li><a href="/tag/github">github (2)</a></li>
                
                <li><a href="/tag/unix">unix (1)</a></li>
                
                <li><a href="/tag/c">c (1)</a></li>
                
                <li><a href="/tag/make">make (1)</a></li>
                
                <li><a href="/tag/linux">linux (1)</a></li>
                
                <li><a href="/tag/osx">osx (2)</a></li>
                
                <li><a href="/tag/sdl">sdl (1)</a></li>
                
                <li><a href="/tag/game-engine">game-engine (1)</a></li>
                
                <li><a href="/tag/open-source">open-source (1)</a></li>
                
                <li><a href="/tag/ffmpeg">ffmpeg (1)</a></li>
                
                <li><a href="/tag/github-release">github-release (1)</a></li>
                
                <li><a href="/tag/gofinance">gofinance (1)</a></li>
                
                <li><a href="/tag/golang">golang (1)</a></li>
                
                <li><a href="/tag/cross-compiling">cross-compiling (1)</a></li>
                
                <li><a href="/tag/imessage">imessage (1)</a></li>
                
                <li><a href="/tag/applescript">applescript (1)</a></li>
                
                <li><a href="/tag/postgres">postgres (1)</a></li>
                
                <li><a href="/tag/pigz">pigz (1)</a></li>
                
                <li><a href="/tag/rsync">rsync (1)</a></li>
                
                <li><a href="/tag/sysadmin">sysadmin (1)</a></li>
                
                <li><a href="/tag/neovim">neovim (1)</a></li>
                
                <li><a href="/tag/vim">vim (1)</a></li>
                
                <li><a href="/tag/encoding">encoding (1)</a></li>
                
            </ul>
            -->
        </nav>

        <main id="content">
            
    <div class="post">
        <h1>Detecting interlaced video with ffmpeg</h1>
        <aside>September 22, 2013</aside>

        <article>
            <p>Today I had to determine whether a video file is interlaced or not.
This has an effect on which flags I pass to the underlying video player
(<a href="http://mpv.io/">mpv</a> in this case) to enable deinterlacing and get rid
of that nasty combing effect.</p>

<!-- more -->

<p>Searching the internet I found that many people say that you can only
really see if a video is interlaced or not by looking at it frame by
frame. One can’t rely on any metadata present in the video file, which
you can get for example by running
<a href="http://mediainfo.sourceforge.net">mediainfo</a> or
<a href="http://www.ffmpeg.org/ffprobe.html">ffprobe</a>. It happens quite often
that this metadata is just <em>wrong</em>.</p>

<p>While this is true, I have no patience for manually viewing each file,
especially because I’m dealing with thousands of user-submitted videos.
So I kept digging and found an automated solution that, while not 100%
accurate, was more than accurate enough. Anything that slipped through
the cracks will be noticed and the users will hopefully notify me.</p>

<p>It turns out that <strong>ffmpeg</strong> has a filter called <strong>idet</strong> that (tries
to) detect interlaced frames, and in my experience is quite good at it.
You’ll need a pretty recent version of ffmpeg for this (later 2012 I
believe, the one in the debian wheezy repository is not recent enough).
Here’s an example of how to use it and what happens when I try it on an
interlaced and non-interlaced file:</p>

<pre><code class="language-bash"><span class="c1"># detect interlacing with the ffmpeg "idet" filter, the more frames</span>
<span class="c1"># you extract, the better, though it's never 100% accurate</span>

ffmpeg<span class="w"> </span>-filter:v<span class="w"> </span>idet<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-frames:v<span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-an<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-f<span class="w"> </span>rawvideo<span class="w"> </span>-y<span class="w"> </span>/dev/null<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-i<span class="w"> </span>~/Downloads/some_interlaced_video.mkv
<span class="c1"># Example output (this is interlaced, TFF style)</span>
<span class="c1"># [Parsed_idet_0 @ 0x1ccf7c0] Single frame detection: TFF:167 BFF:0 Progressive:1 Undetermined:0</span>
<span class="c1"># [Parsed_idet_0 @ 0x1ccf7c0] Multi frame detection: TFF:168 BFF:0 Progressive:0 Undetermined:0</span>

ffmpeg<span class="w"> </span>-filter:v<span class="w"> </span>idet<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-frames:v<span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-an<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-f<span class="w"> </span>rawvideo<span class="w"> </span>-y<span class="w"> </span>/dev/null<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-i<span class="w"> </span>~/Downloads/some_non_interlaced_video.mkv
<span class="c1"># Example output (this is not interlaced):</span>
<span class="c1"># [Parsed_idet_0 @ 0x1bcf720] Single frame detection: TFF:0 BFF:0 Progressive:564 Undetermined:84</span>
<span class="c1"># [Parsed_idet_0 @ 0x1bcf720] Multi frame detection: TFF:0 BFF:0 Progressive:623 Undetermined:25</span>

<span class="c1"># flags:</span>
<span class="c1"># -an            = discard audio, we don't need it</span>
<span class="c1"># -f rawvideo    = output raw video</span>
<span class="c1"># -y /dev/null   = discard the output</span>
<span class="c1"># -i ...         = the input file to check</span>
<span class="c1"># -frames:v 100  = extract the first 100 frames</span>
<span class="c1"># -filter:v idet = insert the "idet" filter, which will output whether it has detected interlaced frames</span></code></pre>

<p>If you see many frames next to <em>TFF</em> or <em>BFF</em>, that means a video is
interlaced. On the other hand if there are many in progressive, that
means it’s not interlaced. If undetermined is the majority count, I
guess you better look at the file in person, but that hasn’t happened to
me yet.</p>

<p>Armed with this new tool I thought it would be a good idea to scan my
entire HD looking and check them all with the <em>idet</em> filter:</p>

<pre><code class="language-bash"><span class="c1"># scan all files on your HD, uses GNU parallel</span>
<span class="c1"># I believe this works just as well with standard</span>
<span class="c1"># xargs though</span>
locate<span class="w"> </span>-0<span class="w"> </span><span class="s1">'.mov'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>parallel<span class="w"> </span>-0<span class="w"> </span>./ffmpeg<span class="w"> </span>-filter:v<span class="w"> </span>idet<span class="w"> </span>-frames:v<span class="w"> </span><span class="m">100</span><span class="w"> </span>-an<span class="w"> </span>-f<span class="w"> </span>rawvideo<span class="w"> </span>-y<span class="w"> </span>/dev/null<span class="w"> </span>-i<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>egrep<span class="w"> </span><span class="s1">'idet|Input'</span></code></pre>

<p>It turns out I only had 2, interlaced content indeed is quite rare for
content on a computer, luckily so.</p>

        </article>

        <p>Tags: <a href="/tag/ffmpeg" rel="tag">ffmpeg</a></p>
    </div>

        </main>

        <!-- mathjax config similar to math.stackexchange -->
        <script>
          window.MathJax = {
            tex: {
              inlineMath: [ ['$', '$'], ["\\(", "\\)"] ],
              displayMath: [ ['$$', '$$'], ["\\[", "\\]"] ],
              processEscapes: true,
              autoload: {
                color: [],
                colorv2: ['color']
              },
              packages: {'[+]': ['noerrors']}
            },
            options: {
              skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
              ignoreHtmlClass: 'tex2jax_ignore',
              processHtmlClass: 'tex2jax_process'
            },
            chtml: {
              scale: 1.8
            },
            loader: {
              load: ['[tex]/noerrors']
            }
          };
        </script>
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" id="MathJax-script"></script>
        <script src="/js/pjax-standalone.js"></script>
        <script>
            pjax.connect({
                "container": "content",
                "complete": function() {
                    // reload mathjax after a pjax load
                    MathJax.typesetPromise();
                },
                "autoAnalytics": false
            });
        </script>
    </body>
</html>

